<UserControl x:Class="PersonalBudgetPlanner.Views.BudgetMainContent"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"   
             xmlns:local="clr-namespace:PersonalBudgetPlanner.Services"
             mc:Ignorable="d" d:DesignHeight="600" d:DesignWidth="1000">

    <UserControl.Resources>
        <local:DecimalStringConverter x:Key="DecimalConverter" />
    </UserControl.Resources>
    <Grid>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="320"/>
            <ColumnDefinition Width="*"/>
        </Grid.ColumnDefinitions>

        <Border Grid.Column="0" Background="White" CornerRadius="8" Margin="10" Padding="15">
            <StackPanel>
                <TextBlock Text="NY TRANSAKTION" FontWeight="Bold" FontSize="14" Margin="0,0,0,15" Foreground="#333333"/>

                <Label Content="Beskrivning" Foreground="Gray" Padding="0,5"/>
                <TextBox Text="{Binding NewTransaction.Description, UpdateSourceTrigger=PropertyChanged}" Margin="0,0,0,10"/>

                <Label Content="Belopp" Foreground="Gray" Padding="0,5"/>
                <TextBox Text="{Binding NewTransaction.Amount, Converter={StaticResource DecimalConverter}, UpdateSourceTrigger=PropertyChanged, Mode=TwoWay}" Margin="0,0,0,10"/>

                <Label Content="Kategori" Foreground="Gray" Padding="0,5"/>
                <ComboBox ItemsSource="{Binding Categories}" 
                          SelectedValue="{Binding NewTransaction.CategoryId}"
                          SelectedValuePath="Id" DisplayMemberPath="Name" Margin="0,0,0,10"/>

                <Label Content="Frekvens" Foreground="Gray" Padding="0,5"/>
                <ComboBox ItemsSource="{Binding Frequencies}" 
                          SelectedItem="{Binding NewTransaction.Recurrence}" Margin="0,0,0,25"/>

                <Label Content="Datum" Foreground="Gray" Padding="0,5"/>
                <DatePicker SelectedDate="{Binding NewTransaction.Date}" Margin="0,0,0,25"/>

                <Button Content="Lägg till transaktion" 
                        Command="{Binding AddCommand}" 
                        Style="{StaticResource PrimaryButtonStyle}" 
                        Height="40"/>


                <StackPanel>
                    <TextBlock Text="FRÅNVARO-SIMULATOR" FontWeight="Bold" Margin="0,30,0,5"/>

                    <Label Content="Typ"/>
                    <ComboBox ItemsSource="{Binding AbsenceTypes}" 
              SelectedItem="{Binding SelectedAbsenceType}" 
              Margin="0,0,0,10"/>

                    <DockPanel>
                        <TextBlock Text="Timmar: " VerticalAlignment="Center"/>
                        <TextBlock Text="{Binding SickHours}" FontWeight="Bold" Margin="5,0"/>
                        <Slider Minimum="0" Maximum="160" Value="{Binding SickHours}" 
                TickFrequency="1" IsSnapToTickEnabled="True"/>
                    </DockPanel>
                </StackPanel>
            </StackPanel>

            
        </Border>

        <Grid Grid.Column="1">
            <Grid.RowDefinitions>
                <RowDefinition Height="*"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>

            <DataGrid Grid.Row="0" Margin="10" 
                      ItemsSource="{Binding Transactions}" 
                      SelectedItem="{Binding SelectedTransaction}"
                      AutoGenerateColumns="False" 
                      CanUserAddRows="False"
                      Background="Transparent"
                      BorderThickness="0"
                      RowHeight="35"
                      GridLinesVisibility="None"
                      HeadersVisibility="Column">
                <DataGrid.Columns>
                    <DataGridTextColumn Header="Datum" Binding="{Binding Date, StringFormat=d}" Width="100" IsReadOnly="True"/>
                    <DataGridTextColumn Header="Beskrivning" Binding="{Binding Description}" Width="*" IsReadOnly="True"/>
                    <DataGridTextColumn Header="Kategori" Binding="{Binding CategoryName}" Width="150" IsReadOnly="True"/>
                    <DataGridTextColumn Header="Belopp" Binding="{Binding Amount, StringFormat={}{0:C}}" Width="120" IsReadOnly="True"/>

                    <DataGridTemplateColumn Width="80">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <Button Content="Ta bort" 
                                        Command="{Binding DataContext.DeleteCommand, ElementName=Root}"
                                        CommandParameter="{Binding}"
                                        FontSize="10" Background="#E57373" Foreground="White" 
                                        BorderThickness="0" Padding="5,2" Cursor="Hand">
                                    <Button.Resources>
                                        <Style TargetType="Border">
                                            <Setter Property="CornerRadius" Value="3"/>
                                        </Style>
                                    </Button.Resources>
                                </Button>
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>
                </DataGrid.Columns>
            </DataGrid>

            <Border Grid.Row="1" Background="{StaticResource CardBackgroundBrush}" 
                    CornerRadius="8" Margin="10" Padding="15">
                <StackPanel>
                    <TextBlock Text="UTGIFTER PER KATEGORI" FontSize="11" FontWeight="Bold" Foreground="Gray" Margin="0,0,0,10"/>
                    <ItemsControl ItemsSource="{Binding CategoryData}">
                        <ItemsControl.ItemsPanel>
                            <ItemsPanelTemplate>
                                <WrapPanel />
                            </ItemsPanelTemplate>
                        </ItemsControl.ItemsPanel>
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <Border Background="White" CornerRadius="5" Padding="10,5" Margin="0,0,10,5" BorderBrush="#E0E0E0" BorderThickness="1">
                                    <StackPanel Orientation="Horizontal">
                                        <TextBlock Text="{Binding Name}" FontWeight="SemiBold" Margin="0,0,10,0"/>
                                        <TextBlock Text="{Binding Value, StringFormat={}{0:C}}" Foreground="#D32F2F"/>
                                    </StackPanel>
                                </Border>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </StackPanel>
            </Border>
        </Grid>
    </Grid>
</UserControl>